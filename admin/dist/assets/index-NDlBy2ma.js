import{j as e,T as w,aw as M,r as t,u as B,ax as r,B as C,a as y,b as P,c as _,ay as W,W as R,as as V,Q as D,R as $}from"./index-RN40GIN3.js";import{P as G}from"./index-cCWBJ18I.js";import{T as E}from"./TextField-nZuO35Fk.js";import{F as O}from"./FormControlLabel-8nvg-ha1.js";import{C as Q}from"./Checkbox-FaetVbke.js";import{q as S,F as z,a as H,b as J,c as K,u as X,E as Y,D as Z,C as ee,d as se,e as te,f as ie}from"./index-OCY1AeLZ.js";import{s as ae}from"./spinner-raFFnsSl.js";import{C as re}from"./Container-JzitWhMj.js";import{G as q}from"./Grid-Eqeh4S9L.js";import{T as ne,a as le,b as oe,c as I,d as v,e as ce}from"./TableRow-_CXUst88.js";import{C as L}from"./Chip-ZZkNesSF.js";import{D as de,a as ue}from"./DialogTitle-6TEnE4on.js";import"./FormControl-hzYzaU_O.js";import"./OutlinedInput-5k8n8BVu.js";import"./useFormControl-ymE63IOh.js";import"./InputLabel-OdKkbQhf.js";import"./Select-LOUEVqMY.js";import"./react-is.production.min-pGgGHoNV.js";import"./FormHelperText-7DzgE79G.js";import"./SwitchBase-5ivMydxc.js";function me(){return e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"h3",component:"h3",gutterBottom:!0,children:"Users"}),e.jsx(w,{variant:"subtitle2",children:"Manage Users"})]})}const pe=M.injectEndpoints({endpoints:o=>({getUsers:o.query({query:s=>({url:"users",params:s}),providesTags:["Users"]}),getUser:o.query({query:s=>({url:`users/${s}`})}),createUser:o.mutation({query:s=>({url:"users",method:"POST",body:s}),invalidatesTags:["Users"]}),updateUser:o.mutation({query:({itemId:s,data:n})=>({url:`users/${id}`,method:"PUT",body:n}),invalidatesTags:["Users"]}),deleteUser:o.mutation({query:s=>({url:`users/${s}`,method:"DELETE"})})}),overrideExisting:!1}),{useGetUsersQuery:he,useGetUserQuery:Ve,useCreateUserMutation:xe,useUpdateUserMutation:ge,useDeleteUserMutation:fe}=pe,je=({callback:o,item:s})=>{const[n,x]=t.useState(""),[l,m]=t.useState(""),[c,u]=t.useState(""),[p,g]=t.useState(!1);B();const[d,f]=xe(),[h,U]=ge(),k=()=>{x(""),m(""),u(""),g(!1)},b=i=>{x(i.fullname),m(i.email),g(i.isAdmin)},T=t.useCallback(async()=>{r.loading("saving...",{position:"top-right"});const j=await d({fullname:n,email:l,username:l,isAdmin:p,password:c});console.error("res ",j),j!=null&&j.data?(k(),r.dismiss(),r.success("saved",{position:"top-right"})):(r.dismiss(),r.error("failed",{position:"top-right"}))},[n,l,c,p]),F=t.useCallback(()=>{r.loading("saving...",{position:"top-right"});const i={fullname:n,email:l,username:l,isAdmin:p,password:void 0};c.length>0&&(i.password=c),h({itemId:s._id,data:i}).then(()=>{r.dismiss(),r.success("saved",{position:"top-right"}),k()}).catch(j=>{console.error(j),r.dismiss(),r.error("failed",{position:"top-right"})})},[s,n,l,c,p]);return t.useEffect(()=>{s!=null&&b(s)},[s]),e.jsxs(e.Fragment,{children:[e.jsxs(C,{component:"form",sx:{"& .MuiTextField-root":{m:1}},children:[e.jsx(E,{label:"Fullname",fullWidth:!0,required:!0,value:n,onChange:i=>{x(i.target.value)}}),e.jsx(E,{label:"email",fullWidth:!0,required:!0,value:l,onChange:i=>{m(i.target.value)}}),e.jsx(E,{label:"password",type:"password",fullWidth:!0,required:!0,value:c,onChange:i=>{u(i.target.value)}}),e.jsx(C,{marginLeft:1,marginTop:1,children:e.jsx(O,{label:"Is Admin",control:e.jsx(Q,{checked:p,onChange:i=>g(i.target.checked)})})})]}),e.jsx(C,{marginLeft:1,marginTop:3,children:s?e.jsx(y,{variant:"contained",onClick:F,children:"Update"}):e.jsx(y,{variant:"contained",onClick:T,children:"Save"})})]})},ve=[{id:"default",label:"Default"},{id:"descAlpha",label:"Descending Alphabetical"},{id:"ascAlpha",label:"Ascending Alphabetical"}];let be="text-[#03042499] bg-[#fff] focus:text-[#030424] border-2 p-2 px-[20px] font-[400] rounded-[11px] text-[18px] flex items-center h-[44px] min-w-[150px] justify-between";const Ce=o=>{const{open:s,onClick:n}=o;o.initialValues;const x=o.formik,[l,m]=t.useState(void 0),{activeSort:c}=x.values,u=t.useRef(null),p=d=>{var f;(f=u.current)!=null&&f.contains(d.target)||s&&n()};t.useEffect(()=>(document.addEventListener("mousemove",g),document.addEventListener("mousedown",p),()=>{document.removeEventListener("mousedown",p),document.removeEventListener("mousemove",g)}));const g=d=>{var h;const f=(h=u.current)==null?void 0:h.contains(d.target);f&&!s&&(n(),m("hover")),!f&&s&&(n(),m(void 0))};return e.jsxs(S,{ref:u,as:"div",className:"relative z-20",children:[e.jsx(S.Button,{as:t.Fragment,children:e.jsxs("div",{onClick:()=>{n(),m("click")},className:`${be} cursor-pointer hidden sm:flex `,children:[e.jsx("div",{className:"w-full h-full text-[#03042499]",children:"Sort"}),e.jsxs("div",{className:"flex flex-col justify-center text-[#B3B3B3]",children:[e.jsx(z,{className:" mb-[-4px]"}),e.jsx(H,{className:" mt-[-4px]"})]})]})}),e.jsx(J,{as:t.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",show:s,children:e.jsx(S.Items,{static:!0,as:"ul",className:"",children:e.jsx(K,{value:x,children:e.jsx("div",{className:"absolute z-20 mt-3 bg-white p-3 rounded-md space-y-5 min-w-[282px] border",children:ve.map((d,f)=>{const h=c==d.id;return e.jsx(S.Item,{children:e.jsx("li",{onClick:()=>{x.setFieldValue("activeSort",d.id)},style:{backgroundColor:h?"#F3F0FF":"unset",fontWeight:h?"600":"unset"},className:"h-[30px] rounded-lg flex items-center pl-2 cursor-pointer",children:d.label})},d.id)})})})})})]})};function $e(){const[o,s]=t.useState(!1),[n,x]=t.useState([]),[l,m]=t.useState(null),[c,u]=t.useState(null),p=B(),g=P(_),[d,f]=W.useState(!1),h={activeSort:""},U=X({initialValues:h,onSubmit:a=>{}});let k={...U.values.activeSort&&{orderBy:U.values.activeSort}};const{data:b,isLoading:T}=he(k),[F,i]=fe();console.log("usersData ",b);const j=t.useCallback(()=>{r.loading("loading...",{position:"top-right"}),p.getUsers().then(a=>{r.dismiss(),x(a)})},[]);t.useCallback(a=>n.find(A=>A._id===a),[n]);const N=t.useCallback(a=>{a!=null&&(r.loading("loading...",{position:"top-right"}),F(a._id).then(()=>{r.dismiss(),r.success("deleted",{position:"top-right"}),u(null)}).catch(A=>{r.dismiss(),r.error("failed",{position:"top-right"}),console.error(A)}))},[]);return t.useEffect(()=>{l!=null&&s(!!l)},[l]),t.useEffect(()=>{o||m(null)},[o]),e.jsxs(e.Fragment,{children:[e.jsx(R,{children:e.jsx("title",{children:"Users"})}),e.jsx(G,{children:e.jsx(me,{})}),e.jsxs(re,{maxWidth:"lg",children:[e.jsxs(q,{container:!0,direction:"row",justifyContent:"center",alignItems:"stretch",spacing:3,children:[e.jsxs("div",{className:"px-7 flex w-full justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{variant:"contained",onClick:()=>s(!0),children:"Add user"}),T||i.isLoading?e.jsx("img",{src:ae,alt:"Spinner"}):void 0]}),e.jsx(Ce,{open:d,onClick:()=>f(!d),initialValues:h,formik:U})]}),e.jsx(q,{item:!0,xs:12,children:e.jsx(ne,{component:V,children:e.jsxs(le,{"aria-label":"simple table",children:[e.jsx(oe,{children:e.jsxs(I,{children:[e.jsx(v,{children:"Full name"}),e.jsx(v,{align:"right",children:"Email"}),e.jsx(v,{align:"right",children:"Is Admin"}),e.jsx(v,{align:"right",children:"Actions"})]})}),e.jsx(ce,{children:b==null?void 0:b.map(a=>e.jsxs(I,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsxs(v,{component:"th",scope:"row",children:[a.fullname," ",a._id==g._id?e.jsx(L,{label:"current user",color:"warning",sx:{marginLeft:2}}):null]}),e.jsx(v,{align:"right",children:a.email}),e.jsx(v,{align:"right",children:a.isAdmin?e.jsx(L,{label:"admin",color:"success"}):null}),e.jsxs(v,{align:"right",children:[e.jsx(D,{sx:{p:"10px"},"aria-label":"menu",onClick:()=>m(a),children:e.jsx(Y,{})}),a._id!==g._id?e.jsx(D,{sx:{p:"10px"},onClick:()=>u(a),children:e.jsx(Z,{})}):null]})]},a._id))})]})})})]}),e.jsx($,{anchor:"right",open:o,onClose:()=>{s(!1)},children:e.jsxs(C,{sx:{width:500},children:[e.jsxs(w,{id:"modal-modal-title",variant:"h2",component:"h2",align:"center",marginTop:3,children:[l?"Update a user":"Add a user",e.jsx("span",{style:{position:"absolute",top:10,right:5,cursor:"pointer"},onClick:()=>s(!1),children:e.jsx(ee,{})})]}),e.jsx(C,{padding:5,children:e.jsx(je,{callback:j,item:l||null})})]})}),e.jsxs(de,{open:c!=null,onClose:()=>u(null),"aria-labelledby":"delete tag group","aria-describedby":"Dialog displayed to confirm tag group delete",children:[e.jsx(ue,{id:"alert-dialog-title",children:"Delete user"}),e.jsx(se,{children:e.jsxs(te,{id:"alert-dialog-description",children:["Are you sure to delete ",c==null?void 0:c.fullname," ?"]})}),e.jsxs(ie,{children:[e.jsx(y,{onClick:()=>u(null),children:"Cancel"}),e.jsx(y,{onClick:()=>N(c),autoFocus:!0,children:"Delete"})]})]})]})]})}export{$e as default};
