import{j as e,T as E,aw as Q,r as n,u as G,ax as c,B as T,a as S,ay as $,W as z,as as H,Q as N,R as J}from"./index-RN40GIN3.js";import{P as K}from"./index-cCWBJ18I.js";import{M as X}from"./MenuItem-B-jDr2rN.js";import{C as Y}from"./Checkbox-FaetVbke.js";import{L as Z}from"./ListItemText-LP5BUS3b.js";import{T as D}from"./TextField-nZuO35Fk.js";import{F as w}from"./FormControl-hzYzaU_O.js";import{I as ee}from"./InputLabel-OdKkbQhf.js";import{S as te}from"./Select-LOUEVqMY.js";import{C as se}from"./Chip-ZZkNesSF.js";import{q as F,F as ie,a as ne,b as ae,c as le,u as oe,E as re,D as ce,C as de,d as ue,e as pe,f as me}from"./index-OCY1AeLZ.js";import{s as he}from"./spinner-raFFnsSl.js";import{C as xe}from"./Container-JzitWhMj.js";import{G as P}from"./Grid-Eqeh4S9L.js";import{T as ge,a as fe,b as je,c as W,d as g,e as ve}from"./TableRow-_CXUst88.js";import{D as ye,a as Ce}from"./DialogTitle-6TEnE4on.js";import"./listItemIconClasses-fFuYOhmb.js";import"./listItemTextClasses-Grt4FLsb.js";import"./SwitchBase-5ivMydxc.js";import"./useFormControl-ymE63IOh.js";import"./FormHelperText-7DzgE79G.js";import"./OutlinedInput-5k8n8BVu.js";import"./react-is.production.min-pGgGHoNV.js";function be(){return e.jsxs(e.Fragment,{children:[e.jsx(E,{variant:"h3",component:"h3",gutterBottom:!0,children:"Lists"}),e.jsx(E,{variant:"subtitle2",children:"Manage movies lists"})]})}const Le=Q.injectEndpoints({endpoints:d=>({getAdminLists:d.query({query:t=>({url:"lists/admin-list",params:t}),providesTags:["Lists"]}),getMyList:d.query({query:t=>({url:"lists/my-list",params:t})}),createList:d.mutation({query:t=>({url:"lists",method:"POST",body:t}),invalidatesTags:["Lists"]}),updateList:d.mutation({query:({itemId:t,data:r})=>({url:`lists/${id}`,method:"PUT",body:r}),invalidatesTags:["Lists"]}),deleteList:d.mutation({query:t=>({url:`lists/${t}`,method:"DELETE"}),invalidatesTags:["Lists"]}),addMovieToDefaultList:d.mutation({query:t=>({url:"lists/add-movie-to-default-list",method:"POST",body:{movieId:t}})}),getRandomLists:d.query({query:(t,r)=>({url:"lists",params:{type:t,genre:r}})})}),overrideExisting:!1}),{useGetAdminListsQuery:Te,useGetMyListQuery:tt,useCreateListMutation:Se,useUpdateListMutation:ke,useDeleteListMutation:Fe,useAddMovieToDefaultListMutation:st,useGetRandomListsQuery:it}=Le,Me=({callback:d,item:t})=>{const[r,f]=n.useState(""),[m,v]=n.useState(""),[u,p]=n.useState(""),[x,j]=n.useState(""),[l,h]=n.useState([]),[o,b]=n.useState([]),L=G(),[q,_]=ke(),[M,I]=Se(),A=()=>{f(""),v(""),p(""),j(""),b([])},k=n.useCallback(i=>{f(i.title),p(i.type),j(i.genre),b(l.filter(a=>{var C;return(C=i.content)==null?void 0:C.includes(a._id)}))},[l]),s=()=>{L.getMovies().then(i=>{h(i==null?void 0:i.movies)}).catch(i=>{console.error(i)})},y=n.useCallback(()=>{const i={title:r,content:o.map(a=>a._id),type:u,genre:x};c.loading("saving...",{position:"top-right"}),M(i).then(()=>{c.dismiss(),c.success("saved",{position:"top-right"}),A()}).catch(a=>{c.dismiss(),c.error("failed",{position:"top-right"}),console.error(a)})},[r,m,u,x,o]),R=n.useCallback(()=>{const i={title:r,description:m,type:u,genre:x,content:o.map(a=>a._id)};console.log(i),c.loading("saving...",{position:"top-right"}),q({itemId:t._id,data:i}).then(()=>{c.dismiss(),c.success("saved",{position:"top-right"})}).catch(a=>{c.dismiss(),c.error("failed",{position:"top-right"}),console.error(a)})},[r,m,u,x,t,o]),V=n.useMemo(()=>{const i=[];for(const a of l)i.push(e.jsxs(X,{value:a._id,children:[e.jsx(Y,{checked:o.map(C=>C._id).includes(a._id)}),e.jsx(Z,{primary:a.title})]},a._id));return i},[l,o]);return n.useEffect(()=>{s(),t!=null&&k(t),console.log(t==null?void 0:t.title)},[t]),n.useEffect(()=>{t!=null&&k(t)},[l]),e.jsx(e.Fragment,{children:e.jsxs(T,{component:"form",sx:{"& .MuiTextField-root":{m:1}},children:[e.jsx(D,{label:"Title",fullWidth:!0,required:!0,value:r,onChange:i=>{f(i.target.value)}}),e.jsx(D,{label:"Type (either movies or series)",fullWidth:!0,required:!0,value:u,onChange:i=>{var a;p((a=i.target.value)==null?void 0:a.trim())}}),e.jsx(D,{label:"Genre (only one per list)",fullWidth:!0,required:!0,value:x,onChange:i=>{var a;j((a=i.target.value)==null?void 0:a.trim())}}),(l==null?void 0:l.length)>0?e.jsxs(w,{fullWidth:!0,sx:{marginLeft:1,marginTop:2},children:[e.jsx(ee,{htmlFor:"content",children:"Content"}),e.jsx(te,{value:o.map(i=>i._id),onChange:i=>{const a=i.target.value,C=[];for(const U of a){const B=l.find(O=>O._id===U);B&&C.push(B)}b([...C])},renderValue:()=>e.jsx(T,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:o.map(i=>e.jsx(se,{label:i.title},i._id))}),id:"content",label:"Grouping",placeholder:"Select tags",multiple:!0,children:V})]}):null,e.jsx(T,{marginLeft:1,marginTop:3,children:t?e.jsx(S,{variant:"contained",onClick:R,children:"Update"}):e.jsx(S,{variant:"contained",onClick:y,children:"Save"})})]})})},Ae=[{id:"default",label:"Default"},{id:"descAlpha",label:"Descending Alphabetical"},{id:"ascAlpha",label:"Ascending Alphabetical"}];let De="text-[#03042499] bg-[#fff] focus:text-[#030424] border-2 p-2 px-[20px] font-[400] rounded-[11px] text-[18px] flex items-center h-[44px] min-w-[150px] justify-between";const Ee=d=>{const{open:t,onClick:r}=d;d.initialValues;const f=d.formik,[m,v]=n.useState(void 0),{activeSort:u}=f.values,p=n.useRef(null),x=l=>{var h;(h=p.current)!=null&&h.contains(l.target)||t&&r()};n.useEffect(()=>(document.addEventListener("mousemove",j),document.addEventListener("mousedown",x),()=>{document.removeEventListener("mousedown",x),document.removeEventListener("mousemove",j)}));const j=l=>{var o;const h=(o=p.current)==null?void 0:o.contains(l.target);h&&!t&&(r(),v("hover")),!h&&t&&(r(),v(void 0))};return e.jsxs(F,{ref:p,as:"div",className:"relative z-20",children:[e.jsx(F.Button,{as:n.Fragment,children:e.jsxs("div",{onClick:()=>{r(),v("click")},className:`${De} cursor-pointer hidden sm:flex `,children:[e.jsx("div",{className:"w-full h-full text-[#03042499]",children:"Sort"}),e.jsxs("div",{className:"flex flex-col justify-center text-[#B3B3B3]",children:[e.jsx(ie,{className:" mb-[-4px]"}),e.jsx(ne,{className:" mt-[-4px]"})]})]})}),e.jsx(ae,{as:n.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",show:t,children:e.jsx(F.Items,{static:!0,as:"ul",className:"",children:e.jsx(le,{value:f,children:e.jsx("div",{className:"absolute z-20 mt-3 bg-white p-3 rounded-md space-y-5 min-w-[282px] border",children:Ae.map((l,h)=>{const o=u==l.id;return e.jsx(F.Item,{children:e.jsx("li",{onClick:()=>{f.setFieldValue("activeSort",l.id)},style:{backgroundColor:o?"#F3F0FF":"unset",fontWeight:o?"600":"unset"},className:"h-[30px] rounded-lg flex items-center pl-2 cursor-pointer",children:l.label})},l.id)})})})})})]})};function nt(){const[d,t]=n.useState(!1),[r,f]=n.useState([]),[m,v]=n.useState(null),[u,p]=n.useState(null),x=G(),[j,l]=$.useState(!1),h={activeSort:""},o=oe({initialValues:h,onSubmit:s=>{}});let b={...o.values.activeSort&&{orderBy:o.values.activeSort}};const{data:L,isLoading:q,adminListsLoading:_}=Te(b),[M,I]=Fe(),A=n.useCallback(()=>{c.loading("loading...",{position:"top-right"}),x.getAdminLists().then(s=>{c.dismiss(),console.log(s),f(s)})},[]);n.useCallback(s=>r.find(y=>y._id===s),[r]);const k=n.useCallback(s=>{s!=null&&(c.loading("loading...",{position:"top-right"}),M(s==null?void 0:s._id).then(()=>{c.dismiss(),c.success("deleted",{position:"top-right"}),p(null)}).catch(y=>{c.dismiss(),c.error("failed",{position:"top-right"}),console.error(y),p(null)}))},[]);return n.useEffect(()=>{m!=null&&t(!!m)},[m]),n.useEffect(()=>{d||v(null)},[d]),e.jsxs(e.Fragment,{children:[e.jsx(z,{children:e.jsx("title",{children:"Lists - Configurations"})}),e.jsx(K,{children:e.jsx(be,{})}),e.jsxs(xe,{maxWidth:"lg",children:[e.jsxs(P,{container:!0,direction:"row",justifyContent:"center",alignItems:"stretch",spacing:3,children:[e.jsxs("div",{className:"px-7 flex w-full justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{variant:"contained",onClick:()=>t(!0),children:"Add List"}),_||I.isLoading?e.jsx("img",{src:he,alt:"Spinner"}):void 0]}),e.jsx(Ee,{open:j,onClick:()=>l(!j),initialValues:h,formik:o})]}),e.jsx(P,{item:!0,xs:12,children:e.jsx(ge,{component:H,children:e.jsxs(fe,{"aria-label":"simple table",children:[e.jsx(je,{children:e.jsxs(W,{children:[e.jsx(g,{children:"Title"}),e.jsx(g,{align:"right",children:"Movies"}),e.jsx(g,{align:"right",children:"Type"}),e.jsx(g,{align:"right",children:"Genre"}),e.jsx(g,{align:"right",children:"Actions"})]})}),e.jsx(ve,{children:L==null?void 0:L.map(s=>{var y;return e.jsxs(W,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(g,{component:"th",scope:"row",children:s==null?void 0:s.title}),e.jsx(g,{align:"right",children:(y=s==null?void 0:s.content)==null?void 0:y.length}),e.jsx(g,{align:"right",children:s==null?void 0:s.type}),e.jsx(g,{align:"right",children:s==null?void 0:s.genre}),e.jsxs(g,{align:"right",children:[e.jsx(N,{sx:{p:"10px"},"aria-label":"menu",onClick:()=>{v(s),console.log("hey : ",s)},children:e.jsx(re,{})}),e.jsx(N,{sx:{p:"10px"},onClick:()=>p(s),children:e.jsx(ce,{})})]})]},s==null?void 0:s._id)})})]})})})]}),e.jsx(J,{anchor:"right",open:d,onClose:()=>{t(!1)},children:e.jsxs(T,{sx:{maxWidth:500},children:[e.jsxs(E,{id:"modal-modal-title",variant:"h2",component:"h2",align:"center",marginTop:3,children:[m?"Update a list":"Add a list",e.jsx("span",{style:{position:"absolute",top:10,right:5,cursor:"pointer"},onClick:()=>t(!1),children:e.jsx(de,{})})]}),e.jsx(T,{padding:5,children:e.jsx(Me,{callback:A,item:m||null})})]})}),e.jsxs(ye,{open:u!=null,onClose:()=>p(null),"aria-labelledby":"delete tag group","aria-describedby":"Dialog displayed to confirm tag group delete",children:[e.jsx(Ce,{id:"alert-dialog-title",children:"Delete movie"}),e.jsx(ue,{children:e.jsxs(pe,{id:"alert-dialog-description",children:["Are you sure to delete ",u==null?void 0:u.title," ?"]})}),e.jsxs(me,{children:[e.jsx(S,{onClick:()=>p(null),children:"Cancel"}),e.jsx(S,{onClick:()=>k(u),autoFocus:!0,children:"Delete"})]})]})]})]})}export{nt as default};
